// jslint configuration; btw: don't put a space before 'jslint' below.          
/*jslint browser: true, devel: true, sloppy: true, vars: true, es5: true */
/*global $, L, map */

$(document).on('ready', function () {

    var osm = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png'),
        transport = L.tileLayer('http://{s}.tile2.opencyclemap.org/transport/{z}/{x}/{y}.png');
        bestuurlijke_grenzen = L.tileLayer('http://dev1.nxt.lizard.net:9000/bestuurlijke_grenzen/{z}/{x}/{y}.png');

    var layers = {'geslotenleiding': 'http://dev1.nxt.lizard.net:9000/geslotenleiding/{z}/{x}/{y}.png',
                  'bestuurlijke_grenzen': 'http://dev1.nxt.lizard.net:9000/bestuurlijke_grenzen/{z}/{x}/{y}.png'};
                 

    var map = L.map('map', {
        center: new L.LatLng(52.0992287, 5.5698782),
        zoomControl: false,
        keyboard: false, // solves problem with Chrome top bar hiding on map click, but prevents keyboard navigation... has to do with tabindex being autogenerated in newest leaflet version!
        zoom: 8,
        layers: [transport]
    });

    var baseMaps = {
        "Openstreetmap": osm,
        "Transport": transport,
        "Bestuurlijke grenzen": bestuurlijke_grenzen
    };


    var wijken = $.getJSON('/static/data/wijken.geojson', function (data) {
        L.geoJson(data, {
            style: function (feature) {
                return {color: feature.properties.color};
            },
            onEachFeature: function (feature, layer) {
                layer.bindPopup(feature.properties.description);
            }
        }).addTo(map);
    });

    L.control.layers(baseMaps).addTo(map);

    L.tileLayer(layers.geslotenleiding,
                {'minZoom': 14})
        .addTo(map)
        .bringToFront();

    var utfGrid = new L.UtfGrid('http://dev1.nxt.lizard.net:9000/bestuurlijke_grenzen_utfgrid/{z}/{x}/{y}.json?callback={cb}', {resolution: 4});

    map.addLayer(utfGrid);
    function hovering(e) {
        var popup = L.popup()
            .setLatLng(e.latlng)
            .setContent('Naam: ' + e.data.gemeentenaam + '<br/>' +
                        'Mannen: ' + e.data.mannen + '<br/>' +
                        '% Verweduwd: ' + e.data.percentage_verweduwd + '<br/>' +
                        'Vrouwen: ' + e.data.vrouwen)
            .openOn(map);
    }

    utfGrid.on('mouseover', function (e) {
        if (e.data) {
            hovering(e);
        } else {
            alert('click: nothing');
        }
    });

});
