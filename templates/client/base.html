{% load i18n %}
<!DOCTYPE html>
<html ng-app="lizard-nxt" ng-controller="MasterCtrl" ng-keydown="keyPress($event)" ng-mousemove="mouseMove($event)">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Lizard</title>
    
    {% block css %}
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}distjs/css/vendor.css" />
    <link href='http://fonts.googleapis.com/css?family=Petit+Formal+Script|Kite+One|Roboto+Slab' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}distjs/css/nxt.css" />
    {% endblock css %}

    <script>
      var debug = true;

      var baseLayers = {{ strap_base_layers }};
      var layers = {{ strap_layers }};
      var data_bounds = {{ strap_data_bounds }};
      var data_bbox = {{ strap_data_bbox }};
    
      var threedi_api_url = "{{ threedi_instance.api_url }}";
      var threedi_subgrid_url = "{{ threedi_instance.socket_url }}";
      var threedi_wms_server_url = "{{ threedi_instance.wms_url }}";
      var threedi_data_url = "{{ threedi_instance.data_url }}";

      function logOut() {
        var r=confirm("Weet u zeker dat u wilt uitloggen?");
        if (r==true) {
          window.location = "{% url "login" %}?next=/";
          }
        else {
          return false;
        }
        }
    </script>
  </head>

  <body ng-controller="Threedi">
    <header class="navbar navbar-inverse navbar-fixed-top">
      <!-- <div id="logo-row" class=""> -->
        <div id="logo">
          <a href="/"><img src="{{ STATIC_URL }}source/assets/images/logo_text.png" alt="Lizard"></a>
        </div>
        <!-- <div id="site-actions">                  id="rightbar-actions"-->
          <ul class="nav navbar-nav navbar-right" >
            {% if user.is_authenticated %}
              <li>
                <a class="user" href="http://sso.lizard.net/edit_profile/" title="{% trans 'Edit profile' %}"><div class="pull-right" id="username"> {{ user.first_name }}</div><i id="user-icon" class="icon-user pull-right"></i></a>
              </li>
              <li>
                <a class="user" id="logout" href="{% url "lizard_auth_client.sso_logout" %}?next=/" title="{% trans 'Logout' %}" onclick="return logOut()"> 
                  <i class="icon-off"></i></a>
              </li>
            {% else %}
              <li>
                <a href="{% url "login" %}?next=/" title="{% trans 'Login' %}">
                  <i class="icon-user pull-right"></i></a>
              </li>
              {% endif %}
            </ul>
            {% block site_actions %}{% endblock site_actions %}
          </div>
        </div>
      <!-- </div> -->
    </header>
    {% block content %}
    
    <cursor-tooltip enabled="<% tools.cursorTooltip.enabled %>" class="cursor-tooltip"  ng-class="{hide: !tools.cursorTooltip.enabled}"></cursor-tooltip>

    <div ng-controller='MapCtrl'>
      <div class="layer-menu-container">
        <div class="layer-switcher-wrapper pull-right" ng-class="{'slide-left': mapState.enabled}">
          <div class="layer-switcher slide-left">
            <ul class="nav">
              <li class="nav-header">
              {% trans "Basis" %}
              <ul class="list-group">
                <li ng-repeat="layer in mapState.baselayers | orderBy:'order':true">
                <input id="<%layer.id%>-baselayer" class="hide" type="radio" ng-model="mapState.activeBaselayer" ng-value="layer.id" name="baselayer" ng-change="switchBaseLayer()"> 
                <label class="ng-class: {active: layer.active};" for="<% layer.id %>-baselayer" ng-bind="layer.name"></label>
                </li> 
              </ul>
              </li>
              <li class="nav-header">
              {% trans "Thema" %}
              <ul class="list-group">
                <li ng-repeat="layer in mapState.layers | orderBy:'order':true">
                <input id="<%layer.id%>-layer" class="hide" type="checkbox" ng-model="layer.active" ng-change="changed()">
                <label class="ng-class: {active: layer.active};" for="<% layer.id %>-layer" ng-bind="layer.name"></label>

                <div ng-switch="layer.follow_3di" style="float: right;">
                  <div ng-switch-when="undefined">
                    <i class="surface-info icon-info pull-right zoomto-icon" ng-class="{visible: layer.active && (layer.name === 'Riolering')}" ng-click="toggleTool('pipe_surface')"></i>
                    <i class="icon-screenshot pull-right zoomto-icon" ng-class="{visible: layer.active}" ng-click="zoomToTheMagic(layer)"></i>
                  </div>
                  <div ng-switch-when="true">
                    <i class="icon-eye-close pull-right zoomto-icon" ng-class="{visible: layer.active}" ng-click="setFollow(layer, false)"></i>
                  </div>
                  <div ng-switch-when="false">
                    <i class="icon-eye-open pull-right zoomto-icon" ng-class="{visible: layer.active}" ng-click="setFollow(layer, true)"></i>
                  </div>
                </div>
                </li>
                <li ng-click="toggleRain()" class="clickable"><label ng-class="{active: rain.enabled}">Regen</label> </li>
              </ul>
              </li>
              <!-- Temporary item to enable events -->
              <li id="events" class="nav-header">
              {% trans "Events" %}
              <ul class="list-group">
                <li ng-repeat="event in mapState.eventTypes">
                <label class="ng-class: {active: timeState.timeline.data[event.name].active};" ng-bind="event.name" ng-click="timeState.toggleEvents(event.name)"></label>
                <label class="count"  ng-if="timeState.timeline.data[event.name].active"><% timeState.timeline.data[event.name].currentCount %>&nbsp;(<% timeState.timeline.data[event.name].count %>) </label>
              </ul>
              </li>
            </ul>
          </div>
          <div id="ribbon" class="ribbon">
            <div class="arrow arrow-up" ng-click="toggleLayerSwitcher()" title="{% trans 'Map layers' %}">
            </div>
            <div class="arrow arrow-down" ng-click="toggleLayerSwitcher()" title="{% trans 'Map layers' %}"><i class="icon-compass ribbon-icon"></i>
            </div>
          </div>
          <div class="button-list-container" id="">
            <div class="button-list-item"><a href="#" ng-click="toggleTool('profile')" class="button-list-link" title="{% trans 'Intersect tool' %}" ng-class="{'active': tools.active === 'profile'}"><i class="icon-resize-full"></i></a></div>
            <div class="button-list-item"><a href="#" ng-click="box.type = 'elevation'" class="button-list-link" title="{% trans 'Elevation curve' %}" ng-class="{'active': box.type === 'elevation'}"><i class="icon-signal"></i></a></div>
            <div class="button-list-item"><a href="#" ng-click="box.type = 'landuse'" class="button-list-link" title="{% trans 'Land use distribution' %}" ng-class="{'active': box.type === 'landuse'}"><i class="icon-circle-blank"></i></a></div>
            <!-- <div class="button-list-item"><a href="#" ng-click="toggleTool('rain')" class="button-list-link" title="{% trans 'Rain App' %}" ng-class="{'active': tools.active === 'rain'}"><i class="icon-cloud"></i></a></div> -->
            <div class="hide button-list-item" ng-class="{'hide': !threedi_active}"><a href="#" ng-click="threediTool()" class="button-list-link" title="3Di" ng-class="{'active': tools.active === 'threedi'}"><i class="icon-asterisk"></i></a></div>
          </div>
        </div>
        <map layer-switch 
             pan-zoom="panZoom"
             layers="mapState.layers"
             rasterprofile="disabled"
             locate="locate"
             zoom-to-layer="zoomToLayer"
             vectorlayer
             surfacelayer
             threedi-map
             rain
             rain-aggregate
             ng-class="{'crosshair': tools.active === 'profile'}">
         </map>
      </div>
        <timeline 
        class="navbar timeline navbar-fixed-bottom">
        </timeline>

      </div>

    {% block box_awesome %}{% endblock %}
    <div class="container">
      <omnibox id="omnibox">
  
      </omnibox>
    </div>
  </div> <!-- MapCtrl Closed.-->

{% block toolbar_controllers %}

        {% endblock toolbar_controllers %}
    {% endblock content %}



    {% block javascript_body %}
    <script type="text/javascript" src="{{ STATIC_URL }}distjs/js/ng.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}distjs/js/vendor.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}distjs/js/nxt.js?{{ random_string }}"></script>
    {% endblock %}

  </body>
</html>
